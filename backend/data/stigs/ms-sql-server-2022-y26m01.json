{"title":"Microsoft SQL Server 2022 Database Security Technical Implementation Guide","description":"This Security Technical Implementation Guide is published as a tool to improve the security of Department of Defense (DOD) information systems. The requirements are derived from the National Institute of Standards and Technology (NIST) 800-53 and related documents. Comments or proposed revisions to this document should be sent via email to the following address: disa.stig_spt@mail.mil.","version":"1","releaseInfo":"Release: 2 Benchmark Date: 05 Jan 2026","rules":[{"id":"SV-271118r1107970_rule","stigId":"V-271118","groupId":"V-271118","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT I","description":"Enterprise environments make account management for applications and databases challenging and complex. A manual process for account management functions adds the risk of a potential oversight or other error. Managing accounts for the same person in multiple places is inefficient and prone to problems with consistency and synchronization. A comprehensive application account management process that includes automation helps to ensure that accounts designated as requiring attention are consistently and promptly addressed. Examples include using automation to act on multiple accounts designated as inactive, suspended, or terminated, or by disabling accounts located in noncentralized account stores, such as multiple servers. Account management functions can also include assignment of group or role membership; identifying account type; specifying user access authorizations (i.e., privileges); account removal, update, or termination; and administrative alerts. Using automated mechanisms can include, for example: using email or text messaging to notify account managers when users are terminated or transferred; using the information system to monitor account usage; and using automated telephone notification to report atypical system account usage. SQL Server must be configured to automatically use organization-level account management functions, and these functions must immediately enforce the organization's current account policy. Automation may comprise differing technologies that when placed together contain an overall mechanism supporting an organization's automated account management requirements.","fixText":"If mixed mode is required, document the need and justification; describe the measures taken to ensure the use of SQL Server authentication is kept to a minimum; describe the measures taken to safeguard passwords; list or describe the SQL Logins used; and obtain official approval.\n\nIf mixed mode is not required, disable it as follows: \n\nIn the SSMS Object Explorer, right-click on the server instance, select Properties >> Security page. Click the radio button for \"Windows Authentication Mode\", and then click \"OK\".\n\nRestart the SQL Server instance. \n\nOR\n\nRun the statement: \n\nUSE [master]\nEXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'LoginMode', REG_DWORD, 2\nGO\n\nRestart the SQL Server instance. \n\nFor each account being managed by SQL Server but not requiring it, drop or disable the SQL Database user. Replace it with an appropriately configured account, as needed.\n\nTo drop a User in the SSMS Object Explorer: \n\nNavigate to Databases >> Security Users. Right-click on the username and then click \"Delete\".\n\nTo drop a User via a query: \n\nUSE database_name;\nDROP USER <user_name>;","checkText":"Determine if SQL Server is configured to allow the use of contained databases, if it is, take the appropriate precautions to limit their risk.\n\n1. In the Object Explorer in SQL Server Management Studio (SSMS), right-click on the server instance, select \"Properties\", and then select the \"Advanced\" page.\n\nIf \"Enabled Contained Databases\" is \"False\", this is not a finding.\n\n2. If \"Enabled Contained Databases\" is \"True\", then in a query interface such as the SSMS Transact-SQL editor, run the statement:\n\nEXEC sp_configure 'contained database authentication'\n\nIf the returned value in the \"config_value\" or \"run_value\" column is \"0\", this is not a finding.\n\n3. Determine whether SQL Server is configured to use only Windows authentication. In a query interface such as the SSMS Transact-SQL editor, run the statement:\n\nSELECT CASE SERVERPROPERTY('IsIntegratedSecurityOnly')  \n WHEN 1 THEN 'Windows Authentication'  \n WHEN 0 THEN 'Windows and SQL Server Authentication'  \nEND as [Authentication Mode]\n\nIf the returned value in the \"Authentication Mode\" column is \"Windows Authentication\", this is not a finding.\n\nIf mixed mode (both SQL Server authentication and Windows authentication) is in use, then it must be documented and approved.\n\nFrom the documentation, obtain the list of accounts authorized to be managed by SQL Server. Determine the accounts (SQL Logins) actually managed by SQL Server.\n\nRun the statement:\n\nSELECT name\nFROM sys.database_principals\nWHERE type_desc = 'SQL_USER'\nAND authentication_type_desc = 'DATABASE';\n\nIf any accounts listed by the query are not listed in the documentation, this is a finding.\n\nDocumentation must be approved by the information system security officer (ISSO)/information system security manager (ISSM).","cciIds":["CCI-000015"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271119r1137654_rule","stigId":"V-271119","groupId":"V-271119","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT I","description":"Authentication with a DOD-approved PKI certificate does not necessarily imply authorization to access the DBMS. To mitigate the risk of unauthorized access to sensitive information by entities that have been issued certificates by DOD-approved PKIs, all DOD systems, including databases, must be properly configured to implement access control policies. Successful authentication must not automatically give an entity access to an asset or security boundary. Authorization procedures and controls must be implemented to ensure each authenticated entity also has a validated and current authorization. Authorization is the process of determining whether an entity, once authenticated, is permitted to access a specific asset. Information systems use access control policies and enforcement mechanisms to implement this requirement. Access control policies include identity-based policies, role-based policies, and attribute-based policies. Access enforcement mechanisms include access control lists, access control matrices, and cryptography. These policies and mechanisms must be employed by the application to control access between users (or processes acting on behalf of users) and objects (e.g., devices, files, records, processes, programs, and domains) in the information system. This requirement is applicable to access control enforcement applications, a category that includes database management systems. If SQL Server does not follow applicable policy when approving access, it may be in conflict with networks or other applications in the information system. This may result in users either gaining or being denied access inappropriately and in conflict with applicable policy.","fixText":"Configure SQL Server settings and access controls to permit user access only to objects and data that the user is authorized to view or interact with, and to prevent access to all other objects and data.\n\nUse GRANT, REVOKE, DENY, ALTER ROLE … ADD MEMBER … and/or ALTER ROLE …. DROP MEMBER statements to add and remove permissions on database-level securables, bringing them into line with the documented requirements.","checkText":"If the database is tempdb, this is Not Applicable.\n\nCheck SQL Server settings to determine whether users are restricted from accessing objects and data they are not authorized to access.\n\nReview the system documentation to determine the required levels of protection for securables in the database by type of user. \n\nReview the permissions in place in the database. \n\nIf the permissions do not match the documented requirements, this is a finding.\n\nUse the supplemental file \"Database permission assignments to users and roles.sql\".","cciIds":["CCI-000213"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271121r1109177_rule","stigId":"V-271121","groupId":"V-271121","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Nonrepudiation of actions taken is required to maintain data integrity. Examples of particular actions taken by individuals include creating information, sending a message, approving information (e.g., indicating concurrence or signing a contract), and receiving a message. Nonrepudiation protects against later claims by a user of not having created, modified, or deleted a particular data item or collection of data in the database. In designing a database, the organization must define the types of data and the user actions that must be protected from repudiation. The implementation must then include building audit features into the application data tables and configuring SQL servers’ audit tools to capture the necessary audit trail. Design and implementation also must ensure that applications pass individual user identification to SQL Server, even where the application connects to the DBMS with a standard, shared account. Applications should use temporal tables to track the changes and history of sensitive data.","fixText":"Alter sensitive tables to use system versioning.\n\n --Alter non-temporal table to define periods for system versioning\n ALTER TABLE <MyTableName>\n ADD PERIOD FOR SYSTEM_TIME (SysStartTime, SysEndTime),\n SysStartTime datetime2 GENERATED ALWAYS AS ROW START HIDDEN NOT NULL\n     DEFAULT SYSUTCDATETIME(),\n SysEndTime datetime2 GENERATED ALWAYS AS ROW END HIDDEN NOT NULL\n     DEFAULT CONVERT(DATETIME2, '9999-12-31 23:59:59.99999999') ;\n \n --Enable system versioning with 1 year retention for historical data\n ALTER TABLE <MyTableName>\n SET (SYSTEM_VERSIONING = ON (HISTORY_RETENTION_PERIOD = 1 YEAR)) ;\n \nhttps://docs.microsoft.com/sql/t-sql/statements/alter-table-transact-sql?view=sql-server-2022#system_versionin","checkText":"Check the server documentation to determine if collecting and keeping historical versions of a table is required.\n\nIf collecting and keeping historical versions of a table is NOT required, this is not a finding.\n\nFind all of the temporal tables in the database using the following query:\n\nSELECT SCHEMA_NAME(T.schema_id) AS schema_name, T.name AS table_name, T.temporal_type_desc, SCHEMA_NAME(H.schema_id) + '.' + H.name AS history_table\nFROM sys.tables T\nJOIN sys.tables H ON T.history_table_id = H.object_id\nWHERE T.temporal_type != 0\nORDER BY schema_name, table_name\n\nUsing the system documentation, determine which tables are required to be temporal tables.\n\nIf any tables listed in the documentation are not in the list created by running the above statement, this is a finding.\n\nVerify that a field exists documenting the login and/or user who last modified the record. If this does not exist, this is a finding.\n\nReview the system documentation to determine the history retention period.\n\nNavigate to the table in Object Explorer. Right-click on the table and then select Script Table As >> CREATE To >> New Query Editor Window.\n\nLocate the line that contains \"SYSTEM_VERSIONING\".\n\nLocate the text that states \"HISTORY_RETENTION_PERIOD\".\n\nIf this text is missing or is set to a value less than the documented history retention period, this is a finding.","cciIds":["CCI-000166"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271122r1109180_rule","stigId":"V-271122","groupId":"V-271122","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Nonrepudiation of actions taken is required to maintain data integrity. Examples of particular actions taken by individuals include creating information, sending a message, approving information (e.g., indicating concurrence or signing a contract), and receiving a message. Nonrepudiation protects against later claims by a user of not having created, modified, or deleted a particular data item or collection of data in the database. In designing a database, the organization must define the types of data and the user actions that must be protected from repudiation. The implementation must then include building audit features into the application data tables and configuring the DBMS's audit tools to capture the necessary audit trail. Design and implementation also must ensure that applications pass individual user identification to the DBMS, even where the application connects to the DBMS with a standard, shared account. SQL Server provides the ability for high privileged accounts to impersonate users in a database using the TRUSTWORTHY feature. This will allow members of the fixed database role to impersonate any user within the database.","fixText":"Disable trustworthy on the database.\n\nALTER DATABASE [<database name>] SET TRUSTWORTHY OFF;","checkText":"If the database being reviewed is MSDB, trustworthy is required to be enabled, and therefore this is not a finding.\n\nExecute the following query:\n\nSELECT\n[DatabaseName] = d.name\n,[DatabaseOwner] = login.name\n,[IsTrustworthy] = CASE\nWHEN d.is_trustworthy_on = 0 THEN 'No'\nWHEN d.is_trustworthy_on = 1 THEN 'Yes'\nEND\n,[IsOwnerPrivilege] = CASE\nWHEN role.name IN ('sysadmin','securityadmin')\nOR permission.permission_name = 'CONTROL SERVER'\nTHEN 'YES'\nELSE 'No'\nEND\nFROM sys.databases d\nLEFT JOIN sys.server_principals login ON d.owner_sid = login.sid\nLEFT JOIN sys.server_role_members rm ON login.principal_id = rm.member_principal_id\nLEFT JOIN sys.server_principals role ON rm.role_principal_id = role.principal_id\nLEFT JOIN sys.server_permissions permission ON login.principal_id = permission.grantee_principal_id\nWHERE d.name <> 'msdb'\n\nIf trustworthy is not enabled, this is not a finding.\n\nIf trustworthy is enabled and the database owner is not a privileged account, this is not a finding.\n\nIf trustworthy is enabled and the database owner is a privileged account, review the system documentation to determine if the trustworthy property is required and authorized. If this is not documented, this is a finding.","cciIds":["CCI-000166"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271124r1109215_rule","stigId":"V-271124","groupId":"V-271124","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Without the capability to restrict which roles and individuals can select which events are audited, unauthorized personnel may be able to prevent or interfere with the auditing of critical events. Suppression of auditing could permit an adversary to evade detection. Misconfigured audits can degrade the system's performance by overwhelming the audit log. Misconfigured audits may also make it more difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.","fixText":"Create a database role specifically for audit maintainers, and give it permission to maintain audits without granting it unnecessary permissions. (The role name used below is an example; other names may be used.)\n\nCREATE ROLE DATABASE_AUDIT_MAINTAINERS;\nGO\n\nGRANT ALTER ANY DATABASE AUDIT TO DATABASE_AUDIT_MAINTAINERS;\nGO\n\nUse REVOKE and/or DENY and/or ALTER ROLE ... DROP MEMBER ... statements to remove the ALTER ANY DATABASE AUDIT permission from all users. Then, for each authorized database user, run the statement:\n\nALTER ROLE DATABASE_AUDIT_MAINTAINERS ADD MEMBER;\nGO\n\nUse REVOKE and/or DENY and/or ALTER SERVER ROLE ... DROP MEMBER ... statements to remove CONTROL DATABASE permission from logins that do not need it.","checkText":"Obtain the list of approved audit maintainers from the system documentation.\n\nUse the following query to review database roles and their membership, all of which enable the ability to create and maintain audit specifications.\n\nSELECT\n    R.name AS role_name,\n    RM.name AS role_member_name,\n    RM.type_desc\nFROM sys.database_principals R\nJOIN sys.database_role_members DRM ON \n    R.principal_id = DRM.role_principal_id\nJOIN sys.database_principals RM ON \n    DRM.member_principal_id = RM.principal_id\nWHERE R.type = 'R'\n    AND R.name = 'db_owner'\nORDER BY \n    role_member_name\n\nIf any role memberships are not documented and authorized, this is a finding. \n\nReview the database roles and individual users that have the following permissions, all of which enable the ability to create and maintain audit definitions.\n\nALTER ANY DATABASE AUDIT\nCONTROL\n\nUse the following query to determine the roles and users that have the listed permissions:\n\nSELECT\nPERM.permission_name,\nDP.name AS principal_name,\nDP.type_desc AS principal_type,\nDBRM.role_member_name\nFROM sys.database_permissions PERM\nJOIN sys.database_principals DP ON PERM.grantee_principal_id = DP.principal_id\nLEFT OUTER JOIN (\nSELECT\nR.principal_id AS role_principal_id,\nR.name AS role_name,\nRM.name AS role_member_name\nFROM sys.database_principals R\nJOIN sys.database_role_members DRM ON R.principal_id = DRM.role_principal_id\nJOIN sys.database_principals RM ON DRM.member_principal_id = RM.principal_id\nWHERE R.type = 'R'\n) DBRM ON DP.principal_id = DBRM.role_principal_id\nWHERE PERM.permission_name IN ('CONTROL','ALTER ANY DATABASE AUDIT')\nORDER BY\npermission_name, \nprincipal_name, \nrole_member_name\n\nIf any of the roles or users returned have permissions that are not documented, or the documented audit maintainers do not have permissions, this is a finding.","cciIds":["CCI-000171"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271143r1167490_rule","stigId":"V-271143","groupId":"V-271143","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"If the system were to allow any user to make changes to software libraries, then those changes might be implemented without undergoing the appropriate testing and approvals that are part of a robust change management process. Accordingly, only qualified and authorized individuals must be allowed to obtain access to information system components for purposes of initiating changes, including upgrades and modifications. Unmanaged changes that occur to the database software libraries or configuration can lead to unauthorized or compromised installations.","fixText":"Transfer ownership of database schemas to authorized database principals.\n\nALTER AUTHORIZATION ON SCHEMA::[<Schema Name>] TO [<Principal Name>]","checkText":"Obtain a listing of schema ownership from the server documentation.\n\nExecute the following query to obtain a current listing of schema ownership.\n\nSELECT s.name AS schema_name, p.name AS owning_principal\n  FROM sys.schemas s\n  JOIN sys.database_principals p ON s.principal_id = p.principal_id\n WHERE p.name != 'dbo'\n   AND (s.name != p.name\n        or p.name not in\n         ( 'db_accessadmin'\n         , 'db_backupoperator'\n         , 'db_datareader'\n         , 'db_datawriter'\n         , 'db_ddladmin'\n         , 'db_denydatareader'\n         , 'db_denydatawriter'\n         , 'db_owner'\n         , 'db_securityadmin'\n         , 'guest'\n         , 'INFORMATION_SCHEMA'\n         , 'sys'\n         , 'TargetServersRole'\n         , 'SQLAgentUserRole'\n         , 'SQLAgentReaderRole'\n         , 'SQLAgentOperatorRole'\n         , 'DatabaseMailUserRole'\n         , 'db_ssisadmin'\n         , 'db_ssisltduser'\n         , 'db_ssisoperator'\n         , 'replmonitor'\n         , '##MS_SSISServerCleanupJobLogin##'\n         )\n       )\n ORDER BY schema_name\n\nIf any schema is owned by an unauthorized database principal, this is a finding.","cciIds":["CCI-001499"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271146r1109183_rule","stigId":"V-271146","groupId":"V-271146","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Within the database, object ownership implies full privileges to the owned object, including the privilege to assign access to the owned objects to other subjects. Database functions and procedures can be coded using definer's rights. This allows anyone who uses the object to perform the actions if they were the owner. If not properly managed, this can lead to privileged actions being taken by unauthorized individuals. Conversely, if critical tables or other objects in SQL Server rely on unauthorized owner accounts, these objects may be lost when an account is removed.","fixText":"Document and obtain approval for any account(s) authorized for object ownership. If necessary, use the ALTER AUTHORIZATION command to change object ownership to an authorized account. \n\nExample provided below. \n\nALTER AUTHORIZATION ON OBJECT::test.table TO AuthorizedUser;\n\nhttps://docs.microsoft.com/en-us/sql/t-sql/statements/alter-authorization-transact-sql","checkText":"Review system documentation to identify SQL Server accounts authorized to own database objects. \n\nIf the SQL Server database ownership list does not exist or needs to be updated, this is a finding. \n\nUse the following query to make this determination: \n\n;with objects_cte as\n(SELECT o.name, o.type_desc,\n   CASE\n    WHEN o.principal_id is null then s.principal_id\n     ELSE o.principal_id\n    END as principal_id\n FROM sys.objects o\n INNER JOIN sys.schemas s\n ON o.schema_id = s.schema_id\n WHERE o.is_ms_shipped = 0\n)\nSELECT cte.name, cte.type_desc, dp.name as ObjectOwner \nFROM objects_cte cte\nINNER JOIN sys.database_principals dp\nON cte.principal_id = dp.principal_id\nORDER BY dp.name, cte.name\n\nIf any of the listed owners are not authorized, this is a finding.","cciIds":["CCI-001499"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271147r1111078_rule","stigId":"V-271147","groupId":"V-271147","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"If SQL Server were to allow any user to make changes to database structure or logic, those changes might be implemented without undergoing the appropriate testing and approvals that are part of a robust change management process. Accordingly, only qualified and authorized individuals must be allowed to obtain access to information system components for purposes of initiating changes, including upgrades and modifications. Unmanaged changes that occur to the database software libraries or configuration can lead to unauthorized or compromised installations. DBMS functionality and the nature and requirements of databases will vary; so, while users are not permitted to install unapproved software, there may be instances where the organization allows the user to install approved software packages such as from an approved software repository. The requirements for production servers will be more restrictive than those used for development and research. The DBMS must enforce software installation by users based on what types of software installations are permitted (e.g., updates and security patches to existing software) and what types of installations are prohibited (e.g., software whose pedigree regarding being potentially malicious is unknown or suspect) by the organization. In the case of a database management system, this requirement covers stored procedures, functions, triggers, views, etc. Satisfies: SRG-APP-000133-DB-000362, SRG-APP-000133-DB-000179, SRG-APP-000378-DB-000365","fixText":"Document and obtain approval for any nonadministrative users who require the ability to create, alter, or replace logic modules.\n\nRevoke the ALTER permission from unauthorized users and roles:\n\nREVOKE ALTER ON [<Object Name>] FROM [<Principal Name>]","checkText":"If the SQL Server instance supports only software development, experimentation, and/or developer-level testing (i.e., excluding production systems, integration testing, stress testing, and user acceptance testing), this is not a finding. \n\nObtain a listing of users and roles who are authorized to create, alter, or replace logic modules from the server documentation.\n\nIn each user database, execute the following query:\n\nSELECT P.type_desc AS principal_type, P.name AS principal_name,\nO.type_desc,\nCASE class\nWHEN 0 THEN DB_NAME()\nWHEN 1 THEN OBJECT_SCHEMA_NAME(major_id) + '.' + OBJECT_NAME(major_id)\nWHEN 3 THEN SCHEMA_NAME(major_id)\nELSE class_desc + '(' + CAST(major_id AS nvarchar) + ')'\nEND AS securable_name, DP.state_desc, DP.permission_name\nFROM sys.database_permissions DP\nJOIN sys.database_principals P ON DP.grantee_principal_id = P.principal_id\nLEFT OUTER JOIN sys.all_objects O ON O.object_id = DP.major_id AND O.type IN ('TR','TA','P','X','RF','PC','IF','FN','TF','U')\nWHERE DP.type IN ('AL','ALTG') AND DP.class IN (0, 1, 53)\n\nSELECT R.name AS role_name, M.type_desc AS principal_type, M.name AS principal_name\nFROM sys.database_principals R\nJOIN sys.database_role_members DRM ON R.principal_id = DRM.role_principal_id\nJOIN sys.database_principals M ON DRM.member_principal_id = M.principal_id\nWHERE R.name IN ('db_ddladmin','db_owner')\nAND M.name <> 'dbo'\n\nIf any users or role permissions returned are not authorized to modify the specified object or type, this is a finding. \n\nIf any user or role membership is not authorized, this is a finding.","cciIds":["CCI-001499","CCI-003980"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271168r1109218_rule","stigId":"V-271168","groupId":"V-271168","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Failure to a known state can address safety or security in accordance with the mission/business needs of the organization. Failure to a known secure state helps prevent a loss of confidentiality, integrity, or availability in the event of a failure of the information system or a component of the system. In the event of a system failure, SQL Server must be able to bring the database back to a consistent state.","fixText":"Modify the system security plan to include whether the database is static, the correct recovery model to be used, the backup schedule, and the plan for testing database restoration. \n\nIn SQL Server Management Studio Object Explorer, right-click on the name of the database; select Properties >> Options page. Set the Recovery Model field (near the top of the page) to the correct value. \n\nIn Object Explorer, expand >> SQL Server Agent >> Jobs. Create, modify, and delete jobs to implement the backup schedule. (Alternatively, this may be done using T-SQL code or third-party backup software.) \n\nCorrect any issues that have been causing backups to fail. \n\nTest the restoration of the database at least once a year; correct any issues that cause it to fail. Maintain a record of these tests.","checkText":"Review the system documentation to determine whether the database is static, the recovery model to be used, the backup schedule, and the plan for testing database restoration.\n\nIf the documentation does not state that the database is static, assume that it is not static. If any of the other information is absent, this is a finding. \n\nIf the database is not static, and the documented recovery model is Bulk Logged, but the justification and authorization for this are not documented, this is a finding. \n\nRun the following to determine Recovery Model:\n\nUSE [master]\nGO\n\nSELECT name, recovery_model_desc\nFROM sys.databases\nORDER BY name\n\nIf the recovery model description does not match the documented recovery model, this is a finding. \n\nReview the jobs set up to implement the backup plan. If they are absent, this is a finding. \n\nCheck the history of the backups by running the following query. It checks the last 30 days of backups by database.\n\nUSE [msdb]\nGO\n\nSELECT database_name, \n   CASE type\n    WHEN 'D' THEN 'Full'\n    WHEN 'I' THEN 'Differential'\n    WHEN 'L' THEN 'Log'\n   ELSE type\n   END AS backup_type,\n is_copy_only,\n backup_start_date, backup_finish_date\nFROM dbo.backupset\nWHERE backup_start_date >= dateadd(day, - 30, getdate()) \nORDER BY database_name, backup_start_date DESC\n\nIf the history indicates a pattern of job failures by missing or gaps in backups, this is a finding. \n\nReview evidence that database recovery is tested annually or more often, and that the most recent test was successful. If not, this is a finding.","cciIds":["CCI-001665"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271169r1109188_rule","stigId":"V-271169","groupId":"V-271169","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Weak passwords may be easily guessed. When passwords are used to encrypt keys used for encryption of sensitive data, the confidentiality of all data encrypted using that key is at risk. Current DOD passwords require the following: - minimum of 15 characters; - at least one uppercase character; - one lowercase character; - one special character; - one numeric character, and - at least eight characters changed from the previous password.","fixText":"Assign an encryption password to the Database Master Key that is a minimum of 15 characters with at least one uppercase character, one lowercase character, one special character, one numeric character, and at least eight characters changed from the previous password. To change the Database Master Key encryption password: \n\nUSE [database name];\nALTER MASTER KEY REGENERATE WITH ENCRYPTION BY PASSWORD = 'new password'; \n\nNote: Do not change the Database Master Key encryption method until the effects are thoroughly reviewed. Changing the master key encryption causes all encryption using the Database Master Key to be decrypted and reencrypted. This action should not be taken during a high-demand time. \n\nRefer to the SQL Server documentation found here prior to reencrypting the Database Master Key: \nhttps://learn.microsoft.com/en-us/sql/relational-databases/security/encryption/create-a-database-master-key?","checkText":"From the query prompt: \n\nSELECT name \nFROM [master].sys.databases \nWHERE state = 0 \n\nRepeat for each database: \nFrom the query prompt: \n\nUSE [database name] \nSELECT COUNT(name) \nFROM sys.symmetric_keys s, sys.key_encryptions k \nWHERE s.name = '##MS_DatabaseMasterKey##' \nAND s.symmetric_key_id = k.key_id \nAND k.crypt_type in ('ESKP', 'ESP2', 'ESP3')\n\nIf the value returned is zero, this is not applicable.\n\nIf the value returned is greater than zero, a Database Master Key exists and is encrypted with a password. \n\nReview procedures and evidence of password requirements used to encrypt Database Master Keys. \n\nIf the passwords do not meet DOD password standards, this is a finding.","cciIds":["CCI-001199"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271170r1109190_rule","stigId":"V-271170","groupId":"V-271170","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"When not encrypted by the Service Master Key, system administrators or application administrators may access and use the Database Master Key to view sensitive data that they are not authorized to view. Where alternate encryption means are not feasible, encryption by the Service Master Key may be necessary. To help protect sensitive data from unauthorized access by DBAs, mitigations may be required. Mitigations may include automatic alerts or other audit events when the Database Master Key is accessed outside of the application or by a DBA account.","fixText":"Where possible, encrypt the Database Master Key with a password known only to the application administrator.\n\nWhere not possible, configure additional audit events or alerts to detect unauthorized access to the Database Master Key by users not authorized to view sensitive data.","checkText":"If no databases require encryption, this is not a finding. \n\nFrom the query prompt: \n\nSELECT name \nFROM [master].sys.databases \nWHERE is_master_key_encrypted_by_server = 1 \nAND state = 0; \n\nIf no databases are returned by the query, this is not a finding. \n\nFor any databases returned, verify in the System Security Plan that encryption of the Database Master Key using the Service Master Key is acceptable and approved by the Information Owner, and the encrypted data does not require additional protections to deter or detect DBA access. If not approved, this is a finding. \n\nIf approved and additional protections are required, verify the additional requirements are in place in accordance with the System Security Plan. These may include additional auditing on access of the Database Master Key with alerts or other automated monitoring. \n\nIf the additional requirements are not in place, this is a finding.","cciIds":["CCI-001199"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271171r1109192_rule","stigId":"V-271171","groupId":"V-271171","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Backup and recovery of the certificate used for encryption is critical to the complete recovery of the database. Not having this key can lead to loss of data during recovery.","fixText":"Document and implement procedures to safely back up and store the Certificate used for encryption. Include in the procedures methods to establish evidence of backup and storage, and careful, restricted access and restoration of the Certificate. Also, include provisions to store the backup off-site. \n\nBACKUP CERTIFICATE 'CertificateName' TO FILE = 'path_to_file' WITH PRIVATE KEY (FILE = 'path_to_pvk', ENCRYPTION BY PASSWORD = 'password'); \n\nAs this requires a password, ensure it is not exposed to unauthorized persons or stored as plain text.","checkText":"If the application owner and authorizing official have determined that encryption of data at rest is not required, this is not a finding.\n\nReview procedures for and evidence of backup of the certificate used for encryption in the System Security Plan. \n\nIf the procedures or evidence does not exist, this is a finding. \n\nIf the procedures do not indicate that a backup of the certificate used for encryption is stored in a secure location that is not on the SQL Server, this is a finding. \n\nIf procedures do not indicate access restrictions to the certificate backup, this is a finding.","cciIds":["CCI-001199"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271172r1109195_rule","stigId":"V-271172","groupId":"V-271172","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"An isolation boundary provides access control and protects the integrity of the hardware, software, and firmware that perform security functions. Security functions are the hardware, software, and/or firmware of the information system responsible for enforcing the system security policy and supporting the isolation of code and data on which the protection is based. Developers and implementers can increase the assurance in security functions by employing well-defined security policy models; structured, disciplined, and rigorous hardware and software development techniques; and sound system/security engineering principles. Database Management Systems typically separate security functionality from nonsecurity functionality via separate databases or schemas. Database objects or code implementing security functionality should not be commingled with objects or code implementing application logic. When security and nonsecurity functionality are commingled, users who have access to nonsecurity functionality may be able to access security functionality.","fixText":"Check documentation and locate security-related database objects and code in a separate database, schema, table, or other separate security domain from database objects and code implementing application logic.\n\nSchemas are analogous to separate namespaces or containers used to store database objects. Security permissions apply to schemas, making them an important tool for separating and protecting database objects based on access rights. Schemas reduce the work required, and improve the flexibility, for security-related administration of a database.\n\nUser-schema separation allows for more flexibility in managing database object permissions. A schema is a named container for database objects, which allows the user group objects into separate namespaces.\n\nWhere possible, locate security-related database objects and code in a separate database, schema, or other separate security domain from database objects and code implementing application logic. In all cases, use GRANT, REVOKE, DENY, ALTER ROLE … ADD MEMBER … and/or ALTER ROLE …. DROP MEMBER statements to add and remove permissions on server-level and database-level security-related objects to provide effective isolation.\n\nConsider submitting a request to the vendor for changes to a COTS database when database structure does not isolate security functions and cannot be altered directly by the database administrators without loss of official support.","checkText":"Determine elements of security functionality (lists of permissions, additional authentication information, stored procedures, application specific auditing, etc.) being housed inside SQL Server.\n\nFor any elements found, check SQL Server to determine if these objects or code implementing security functionality are located in a separate security domain, such as a separate database, schema, or table created specifically for security functionality.\n\nReview the system documentation to determine if the necessary database changes cannot be made and that the blockers are also documented. If the necessary changes are documented as not possible, this is not a finding.\n\nReview the database structure to determine where security-related functionality is stored. If security-related database objects or code is not kept separate, this is a finding.","cciIds":["CCI-001084"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271173r1137656_rule","stigId":"V-271173","groupId":"V-271173","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Applications, including DBMSs, must prevent unauthorized and unintended information transfer via shared system resources. Data used for the development and testing of applications often involves copying data from production. It is important that specific procedures exist for this process, including the conditions under which such transfer may take place, where the copies may reside, and the rules for ensuring sensitive data are not exposed. Copies of sensitive data must not be misplaced or left in a temporary location without the proper controls.","fixText":"Modify any code used for moving data from production to development/test systems to comply with the organization-defined data transfer policy, and to ensure copies of production data are not left in unsecured locations.","checkText":"Review the procedures for the refreshing of development/test data from production. \n\nReview any scripts or code that exists for the movement of production data to development/test systems, or to any other location or for any other purpose. \n\nVerify that copies of production data are not left in unprotected locations. \n\nIf the code that exists for data movement does not comply with the organization-defined data transfer policy and/or fails to remove any copies of production data from unprotected locations, this is a finding.","cciIds":["CCI-001090"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271176r1109200_rule","stigId":"V-271176","groupId":"V-271176","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Invalid user input occurs when a user inserts data or characters into an application's data entry fields and the application is unprepared to process that data. This results in unanticipated application behavior, potentially leading to an application or information system compromise. Invalid user input is one of the primary methods employed when attempting to compromise an application. With respect to database management systems, one class of threat is known as SQL Injection, or more generally, code injection. It takes advantage of the dynamic execution capabilities of various programming languages, including dialects of SQL. Potentially, the attacker can gain unauthorized access to data, including security settings, and severely corrupt or destroy the database. Even when no such hijacking takes place, invalid input that gets recorded in the database, whether accidental or malicious, reduces the reliability and usability of the system. Available protections include data types, referential constraints, uniqueness constraints, range checking, and application-specific logic. Application-specific logic can be implemented within the database in stored procedures and triggers, where appropriate. This calls for inspection of application source code, which will require collaboration with the application developers. It is recognized that in many cases, the database administrator (DBA) is organizationally separate from the application developers, and may have limited, if any, access to source code. Nevertheless, protections of this type are so important to the secure operation of databases that they must not be ignored. At a minimum, the DBA must attempt to obtain assurances from the development organization that this issue has been addressed and must document what has been discovered.","fixText":"Use parameterized queries, constraints, foreign keys, etc., to validate data input. Modify SQL Server to properly use the correct column data types as required in the database.\n\nConsider submitting a request to the vendor for changes to a COTS database when code is discovered that could create invalid inputs and cannot be altered directly by the database administrators without loss of official support.","checkText":"Review SQL Server code (stored procedures, functions, triggers), application code, settings, column and field definitions, and constraints to determine whether the database is protected against invalid input. If code exists that allows invalid data to be acted upon or input into the database, this is a finding. \n\nIf column/field definitions do not reflect the data, this is a finding. \n\nIf columns/fields do not contain constraints and validity checking where required, this is a finding. \n\nWhere a column/field is noted in the system documentation as necessarily free-form, even though its name and context suggest that it should be strongly typed and constrained, the absence of these protections is not a finding. \n\nWhere a column/field is clearly identified by name, caption, or context as Notes, Comments, Description, Text, etc., the absence of these protections is not a finding.","cciIds":["CCI-001310"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271179r1108921_rule","stigId":"V-271179","groupId":"V-271179","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Any DBMS or associated application providing too much information in error messages on the screen or printout risks compromising the data and security of the system. The structure and content of error messages need to be carefully considered by the organization and development team. Databases can inadvertently provide a wealth of information to an attacker through improperly handled error messages. In addition to sensitive business or personal information, database errors can provide host names, IP addresses, usernames, and other system information not required for troubleshooting but very useful to someone targeting the system. Carefully consider the structure/content of error messages. The extent to which information systems are able to identify and handle error conditions is guided by organizational policy and operational requirements. Information that could be exploited by adversaries includes, for example, logon attempts with passwords entered by mistake as the username, mission/business information that can be derived from (if not stated explicitly by) information recorded, and personal information, such as account numbers, social security numbers, and credit card numbers. This calls for inspection of application source code, which will require collaboration with the application developers. It is recognized that in many cases, the database administrator (DBA) is organizationally separate from the application developers, and may have limited, if any, access to source code. Nevertheless, protections of this type are so important to the secure operation of databases that they must not be ignored. At a minimum, the DBA must attempt to obtain assurances from the development organization that this issue has been addressed and must document what has been discovered.","fixText":"Adjust database code to remove any information not required for explaining the error to an end user.\n\nConsider enabling trace flag 3625 to mask certain system-level error information returned to nonadministrative users.\n\n1. Launch SQL Server Configuration Manager >> SQL Services.\n2. Open the instance properties.\n3. Select the \"Service Parameters\" tab.\n4. Enter \"-T3625\". \n5. Click \"Add\" and then click \"OK\".\n6. Restart SQL instance.","checkText":"Review application behavior and custom database code (stored procedures, triggers), to determine whether error messages contain information beyond what is needed for explaining the issue to general users.\n\nIf database error messages contain PII data, sensitive business data, or information useful for identifying the host system or database structure, this is a finding.","cciIds":["CCI-001312"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271184r1138541_rule","stigId":"V-271184","groupId":"V-271184","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Without the association of security labels to information, there is no basis for SQL Server to make security-related access-control decisions. Security labels are abstractions representing the basic properties or characteristics of an entity (e.g., subjects and objects) with respect to safeguarding information. These labels are typically associated with internal data structures (e.g., tables, rows) within the database and are used to enable the implementation of access control and flow control policies; reflect special dissemination, handling, or distribution instructions; or support other aspects of the information security policy. One example includes marking data as classified or CUI. These security labels may be assigned manually or during data processing, but, either way, it is imperative these assignments are maintained while the data is in storage. If the security labels are lost when the data is stored, there is the risk of a data compromise. The mechanism used to support security labeling may be a feature of SQL Server, a third-party product, or custom application code. Satisfies: SRG-APP-000311-DB-000308, SRG-APP-000314-DB-000310","fixText":"Deploy SQL Server Row-Level Security (refer to link below) or a third-party software, or add custom data structures, data elements, and application code, to provide reliable security labeling of information.\n\nhttps://msdn.microsoft.com/en-us/library/dn765131.aspx","checkText":"If security labeling is not required, this is not a finding.\n\nIf security labeling requirements have been specified, but neither a third-party solution nor a SQL Server Row-Level security solution is implemented that reliably maintains labels on information, this is a finding.","cciIds":["CCI-002262","CCI-002263","CCI-002264"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271186r1109206_rule","stigId":"V-271186","groupId":"V-271186","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"DAC is based on the notion that individual users are \"owners\" of objects and therefore have discretion over who should be authorized to access the object and in which mode (e.g., read or write). Ownership is usually acquired because of creating the object or via specified ownership assignment. DAC allows the owner to determine who will have access to objects they control. An example of DAC includes user-controlled table permissions. When discretionary access control policies are implemented, subjects are not constrained regarding what actions they can take with information for which they have already been granted access. Thus, subjects that have been granted access to information are not prevented from passing (i.e., the subjects have the discretion to pass) the information to other subjects or objects. A subject that is constrained in its operation by Mandatory Access Control policies is still able to operate under the less rigorous constraints of this requirement. Thus, while Mandatory Access Control imposes constraints preventing a subject from passing information to another subject operating at a different sensitivity level, this requirement permits the subject to pass the information to any subject at the same sensitivity level. The policy is limited by the information system boundary. Once the information is passed outside of the control of the information system, additional means may be required to ensure the constraints remain in effect. While the older, more traditional definitions of DAC require identity-based access control, that limitation is not required for this use of DAC.","fixText":"To correct object ownership:\n\nALTER AUTHORIZATION ON <Securable> TO <Principal>\n\nTo revoke any unauthorized permissions:\n\nREVOKE [Permission] ON <Securable> FROM <Principal>","checkText":"Review system documentation to determine requirements for object ownership and authorization delegation.\n\nUse the following query to discover database object ownership:\n\nSchemas not owned by the schema or dbo:\n\nSELECT name AS schema_name, USER_NAME(principal_id) AS schema_owner\nFROM sys.schemas\nWHERE schema_id <> principal_id\n AND principal_id <> 1\n\nObjects owned by an individual principal:\n\nSELECT object_id, name AS securable, \n  USER_NAME(principal_id) AS object_owner,\n  type_desc\nFROM sys.objects\nWHERE is_ms_shipped = 0 AND principal_id IS NOT NULL\nORDER BY type_desc, securable, object_owner\n\nUse the following query to discover database users who have been delegated the right to assign additional permissions:\n\nSELECT U.type_desc, U.name AS grantee,\n DP.class_desc AS securable_type,\n   CASE DP.class\n    WHEN 0 THEN DB_NAME()\n    WHEN 1 THEN OBJECT_NAME(DP.major_id) \n    WHEN 3 THEN SCHEMA_NAME(DP.major_id)\n   ELSE CAST(DP.major_id AS nvarchar)\n   END AS securable,\n       permission_name, state_desc\nFROM sys.database_permissions DP\nJOIN sys.database_principals U ON DP.grantee_principal_id = U.principal_id\nWHERE DP.state = 'W'\nORDER BY grantee, securable_type, securable\n\nIf any of these rights are not documented and authorized, this is a finding.","cciIds":["CCI-002165"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271188r1167492_rule","stigId":"V-271188","groupId":"V-271188","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"In certain situations, to provide required functionality, a DBMS must execute internal logic (stored procedures, functions, triggers, etc.) and/or external code modules with elevated privileges. However, if the privileges required for execution are at a higher level than the privileges assigned to organizational users invoking the functionality applications/programs, those users are indirectly provided with greater privileges than assigned by organizations. Privilege elevation must be used only where necessary and protected from misuse. This calls for inspection of application source code, which will require collaboration with the application developers. It is recognized that in many cases, the database administrator (DBA) is organizationally separate from the application developers, and may have limited, if any, access to source code. Nevertheless, protections of this type are so important to the secure operation of databases that they must not be ignored. At a minimum, the DBA must attempt to obtain assurances from the development organization that this issue has been addressed and must document what has been discovered.","fixText":"Alter stored procedures and functions to remove the \"EXECUTE AS\" statement.","checkText":"Review the system documentation to obtain a listing of stored procedures and functions that use impersonation. Execute the following query:\n\nSELECT S.name AS schema_name, O.name AS module_name,\nUSER_NAME(\nCASE M.execute_as_principal_id\nWHEN -2 THEN COALESCE(O.principal_id, S.principal_id)\nELSE M.execute_as_principal_id\nEND\n) AS execute_as\nFROM sys.sql_modules M\nJOIN sys.objects O ON M.object_id = O.object_id\nJOIN sys.schemas S ON O.schema_id = S.schema_id\nWHERE execute_as_principal_id IS NOT NULL\nand       O.name not in \n(             \n'fn_sysdac_get_username',\n                             'fn_sysutility_ucp_get_instance_is_mi',\n                             'sp_send_dbmail',\n                             'sp_SendMailMessage',\n                             'sp_syscollector_create_collection_set',\n                             'sp_syscollector_delete_collection_set',\n                             'sp_syscollector_disable_collector',\n                             'sp_syscollector_enable_collector',\n                             'sp_syscollector_get_collection_set_execution_status',\n                             'sp_syscollector_run_collection_set',\n                             'sp_syscollector_start_collection_set',\n                             'sp_syscollector_update_collection_set',\n                             'sp_syscollector_upload_collection_set',\n                             'sp_syscollector_verify_collector_state',\n                             'sp_syspolicy_add_policy',\n                             'sp_syspolicy_add_policy_category_subscription',\n                             'sp_syspolicy_delete_policy',\n                             'sp_syspolicy_delete_policy_category_subscription',\n                             'sp_syspolicy_update_policy',\n                             'sp_sysutility_mi_add_ucp_registration',\n                             'sp_sysutility_mi_disable_collection',\n                             'sp_sysutility_mi_enroll',\n                             'sp_sysutility_mi_initialize_collection',\n                             'sp_sysutility_mi_remove',\n                             'sp_sysutility_mi_remove_ucp_registration',\n                             'sp_sysutility_mi_upload',\n                             'sp_sysutility_mi_validate_enrollment_preconditions',\n                             'sp_sysutility_ucp_add_mi',\n                             'sp_sysutility_ucp_add_policy',\n                             'sp_sysutility_ucp_calculate_aggregated_dac_health',\n                             'sp_sysutility_ucp_calculate_aggregated_mi_health',\n                             'sp_sysutility_ucp_calculate_computer_health',\n                             'sp_sysutility_ucp_calculate_dac_file_space_health',\n                             'sp_sysutility_ucp_calculate_dac_health',\n                             'sp_sysutility_ucp_calculate_filegroups_with_policy_violations',\n                             'sp_sysutility_ucp_calculate_health',\n                             'sp_sysutility_ucp_calculate_mi_file_space_health',\n                             'sp_sysutility_ucp_calculate_mi_health',\n                             'sp_sysutility_ucp_configure_policies',\n                             'sp_sysutility_ucp_create',\n                             'sp_sysutility_ucp_delete_policy',\n                             'sp_sysutility_ucp_delete_policy_history',\n                             'sp_sysutility_ucp_get_policy_violations',\n                             'sp_sysutility_ucp_initialize',\n                             'sp_sysutility_ucp_initialize_mdw',\n                             'sp_sysutility_ucp_remove_mi',\n                             'sp_sysutility_ucp_update_policy',\n                             'sp_sysutility_ucp_update_utility_configuration',\n                             'sp_sysutility_ucp_validate_prerequisites',\n                             'sp_validate_user',\n                             'syscollector_collection_set_is_running_update_trigger',\n                             'sysmail_help_status_sp'\n)\n\nORDER BY schema_name, module_name\n\nIf any procedures or functions are returned that are not documented, this is a finding.","cciIds":["CCI-002233"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271195r1109208_rule","stigId":"V-271195","groupId":"V-271195","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT II","description":"Failure to provide logical access restrictions associated with changes to configuration may have significant effects on the overall security of the system. When dealing with access restrictions pertaining to change control, it should be noted that any changes to the hardware, software, and/or firmware components of the information system can potentially have significant effects on the overall security of the system. Accordingly, only qualified and authorized individuals should be allowed to obtain access to system components for the purposes of initiating changes, including upgrades and modifications.","fixText":"Remove unauthorized users from roles:\n\nALTER ROLE DROP MEMBER user;\n\nhttps://learn.microsoft.com/en-us/sql/t-sql/statements/alter-role-transact-sql?\n\nSet the owner of the database to an authorized login:\n\nALTER AUTHORIZATION ON database::DatabaseName TO login;\n\nhttps://learn.microsoft.com/en-us/sql/t-sql/statements/alter-authorization-transact-sql?","checkText":"Execute the following query to obtain a listing of user databases whose owner is a member of a fixed server role:\n\n SELECT \n              D.name AS database_name, SUSER_SNAME(D.owner_sid) AS owner_name,\n              FRM.is_fixed_role_member\nFROM sys.databases D\nOUTER APPLY (\n              SELECT MAX(fixed_role_member) AS is_fixed_role_member\n              FROM (\n                            SELECT IS_SRVROLEMEMBER(R.name, SUSER_SNAME(D.owner_sid)) AS fixed_role_member\n                            FROM sys.server_principals R\n                            WHERE is_fixed_role = 1\n              ) A\n) FRM\nWHERE D.database_id > 4\n              AND (FRM.is_fixed_role_member = 1 \n                            OR FRM.is_fixed_role_member IS NULL)\nORDER BY database_name \n\nIf no databases are returned, this is not a finding. \n\nFor each database/login returned, review the Server Role memberships:\n1. In SQL Server Management Studio, expand \"Logins\".\n2. Double-click the name of the login.\n3. Click the \"Server Roles\" tab.\n\nIf any server roles are selected, but not documented and authorized, this is a finding.","cciIds":["CCI-001813"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271199r1117186_rule","stigId":"V-271199","groupId":"V-271199","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT I","description":"Use of weak or untested encryption algorithms undermines the purposes of using encryption to protect data. The application must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated. It is the responsibility of the data owner to assess the cryptography requirements in light of applicable federal laws, Executive Orders, directives, policies, regulations, and standards. NSA-approved cryptography for classified networks is hardware based. This requirement addresses the compatibility of a DBMS with the encryption devices.","fixText":"Configure cryptographic functions to use NSA-approved cryptography compliant algorithms.\n\nUse DOD code-signing certificates to create asymmetric keys stored in the database used to encrypt sensitive data stored in the database.\n\nRun the following SQL script to create a certificate:\n\nUSE \nCREATE CERTIFICATE \n ENCRYPTION BY PASSWORD = <'password'>\n FROM FILE = <'path/file_name'>\n WITH SUBJECT = 'name of person creating key',\n EXPIRY_DATE = '<'expiration date: yyyymmdd'>'\n\nRun the following SQL script to create a symmetric key and assign an existing certificate:\n\nUSE \nCREATE SYMMETRIC KEY <'key name'>\n WITH ALGORITHM = AES_256 \n ENCRYPTION BY CERTIFICATE\n\nFor Transparent Data Encryption (TDE):\n\nUSE master;\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = '';\nCREATE CERTIFICATE  . . .;\nUSE ;\nCREATE DATABASE ENCRYPTION KEY\nWITH ALGORITHM = AES_256\nENCRYPTION BY SERVER CERTIFICATE ;\nALTER DATABASE \nSET ENCRYPTION ON;","checkText":"Detailed information on the NIST Cryptographic Module Validation Program (CMVP) is available at the following website: http://csrc.nist.gov/groups/STM/cmvp/index.html.\n\nReview system documentation to determine whether cryptography for classified or sensitive information is required by the information owner.\n\nIf the system documentation does not specify the type of information hosted on SQL Server as classified, sensitive, and/or unclassified, this is a finding.\n\nIf neither classified nor sensitive information exists within SQL Server databases or configuration, this is not a finding.\n\nVerify that Windows is configured to require the use of FIPS-compliant algorithms.\n\n1. Click \"Start\".\n2. Type \"Local Security Policy\".\n3. Press \"Enter\". \n4. Expand \"Local Policies\". \n5. Select \"Security Options\".\n6. Locate \"System Cryptography:  Use FIPS compliant algorithms for encryption, hashing, and signing\". \n\nIf the Security Setting for this option is \"Disabled\", this is a finding.\n\nNote: The list of acceptable algorithms is \"AES 256\" and \"Triple DES\".\n\nIf cryptography is being used by SQL Server, verify that the cryptography is NIST FIPS 140-2 or 140-3 certified by running the following SQL query:\n\nSELECT DISTINCT name, algorithm_desc\nFROM sys.symmetric_keys\nWHERE key_algorithm NOT IN ('D3','A3')\nORDER BY name\n\nIf any items listed show an uncertified NIST FIPS 140-2 algorithm type, this is a finding.","cciIds":["CCI-002450"],"status":"not_reviewed","findingDetails":"","comments":""},{"id":"SV-271201r1109210_rule","stigId":"V-271201","groupId":"V-271201","title":"DPMS Target MS SQL Server 2022 Database","severity":"CAT I","description":"DBMSs handling data requiring \"data at rest\" protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest. These cryptographic mechanisms may be native to the DBMS or implemented via additional software or operating system/file system settings, as appropriate to the situation. Selection of a cryptographic mechanism is based on the need to protect the integrity of organizational information. The strength of the mechanism is commensurate with the security category and/or classification of the information. Organizations have the flexibility to either encrypt all information on storage devices (i.e., full disk encryption) or encrypt specific data structures (e.g., files, records, or fields). The decision whether and what to encrypt rests with the data owner and is also influenced by the physical measures taken to secure the equipment and media on which the information resides. Satisfies: SRG-APP-000429-DB-000387","fixText":"Where full-disk encryption is required, configure Windows and/or the storage system to provide this. \n\nWhere TDE is required, create a master key, obtain a certificate protected by the master key, create a database encryption key and protect it by the certificate, and then set the database to use encryption. For guidance from MSDN on how to do this, refer to: https://msdn.microsoft.com/en-us/library/bb934049.aspx. \n\nWhere table/column encryption is required, enable encryption on the tables/columns in question. For guidance from the Microsoft Developer Network on how to do this with Always Encrypted, refer to: https://msdn.microsoft.com/en-us/library/mt163865.aspx.","checkText":"Review the system documentation to determine whether the organization has defined the information at rest that is to be protected from disclosure or modification, which must include, at a minimum, PII and classified information. \n\nIf no information is identified as requiring such protection, this is not a finding. \n\nReview the configuration of SQL Server, Windows, and additional software as relevant. \n\nIf full-disk encryption is required, and Windows or the storage system is not configured for this, this is a finding. \n\nIf database transparent data encryption (TDE) is called for, check whether it is enabled: \n\nSELECT\nDB_NAME(database_id) AS [Database Name], CASE encryption_state WHEN 0 THEN 'No database encryption key present, no encryption' \nWHEN 1 THEN 'Unencrypted' \nWHEN 2 THEN 'Encryption in progress' \nWHEN 3 THEN 'Encrypted' \nWHEN 4 THEN 'Key change in progress' \nWHEN 5 THEN 'Decryption in progress' \nWHEN 6 THEN 'Protection change in progress' \nEND AS [Encryption State]\nFROM sys.dm_database_encryption_keys\n\nFor each user database for which encryption is called for and it is marked Unencrypted, this is a finding. \n\nIf table/column encryption and/or a separation between those who own the data (and can view it) and those who manage the data (but should have no access) is required for PII or similar types of data, use Always Encrypted. The details for configuring Always Encrypted are located here: https://msdn.microsoft.com/en-us/library/mt163865.aspx.\n\nReview the definitions and contents of the relevant tables/columns for the Always Encryption settings, if any of the information defined as requiring cryptographic protection is not encrypted this is a finding.","cciIds":["CCI-002475","CCI-002476"],"status":"not_reviewed","findingDetails":"","comments":""}]}